; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
boards_dir = buildroot/boards
default_envs = knomiv2
description = Customized VORON version for 6 toolheads

# need apply https://github.com/lvgl/lvgl/pull/4487
# and add "d->prev_scr = NULL;" in lv_disp.c line_269

#
# Default values apply to all 'env:' prefixed environments
#
[env]
; OTA Upload (optional - commented out for USB-only updates)
; upload_port  = COM37
; upload_protocol = custom
; extra_scripts = platformio_upload_ota.py
; upload_url = http://192.168.1.117/update

; Partition Table: NOOTA with 10MB App + 6MB SPIFFS
board_build.partitions = partitions_16mb_noota.csv

framework = arduino

build_flags =
              "-D TEMPLATE_PLACEHOLDER='$'"
              -DLV_CONF_PATH="../../../../include/lv_conf.h"
              -DCORE_DEBUG_LEVEL=0
              -UMOONRAKER_DEBUG                           ; Disables Moonraker debug output
              -Isrc ; for "tft_setup.h"
              -Wl,-Map,mapfile.map

lib_deps =
              adafruit/Adafruit Unified Sensor @ 1.1.14
              adafruit/Adafruit SHT4x Library @ 1.0.4
              LIS2DW12=https://github.com/stm32duino/LIS2DW12/archive/refs/tags/2.1.0.zip
              lvgl/lvgl@^8.3.7
              bblanchon/ArduinoJson@^6.21.3
              TFT_eSPI=https://github.com/Bodmer/TFT_eSPI/archive/refs/tags/v2.5.0.zip
              ottowinter/ESPAsyncWebServer-esphome @ ^3.0.0
              https://github.com/bigtreetech/AsyncElegantOTA.git
              AsyncTCP=esphome/AsyncTCP-esphome@^2.1.1

#
# KNOMI V2 Environment (ESP32-S3, 16MB Flash)
#
[env:knomiv2]
platform                = espressif32@6.4.0
board                   = esp32s3r8

; Flash configuration for 16MB
board_upload.flash_size = 16MB
board_build.flash_mode  = qio
board_build.f_flash     = 80000000L
board_build.partitions  = partitions_16mb_noota.csv   ; 10MB App, no OTA
board_build.filesystem  = littlefs                    ; LittleFS for better wear-leveling

; Compiler Flags
build_flags             = ${env.build_flags}
                        -DKNOMIV2                     ; V2 Hardware definition
                        -Os                           ; Optimization for size
                        -DBOARD_HAS_PSRAM             ; Enable 8MB PSRAM
                        -I src                        ; Include path for headers
                        -I src/gif                    ; Include path for GIF headers

; Source Filter: What gets compiled?
build_src_filter        = +<*>                        ; All files
                        +<ui/*>                       ; UI components
                        +<ui_overlay/*>               ; Overlay components
                        +<gif/*.c>                    ; GIF animations compiled in

#
# KNOMI V1 Environment (ESP32, 8MB Flash) - Legacy Support
#
[env:knomiv1]
platform               = espressif32@6.4.0
board                  = esp32r8
build_flags            = ${env.build_flags}
                         -DKNOMIV1
